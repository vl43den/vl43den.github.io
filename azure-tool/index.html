<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PySigma Web Converter</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; line-height: 1.6; }
        #log { background: #f4f4f4; padding: 15px; border-radius: 5px; border: 1px solid #ddd; height: 300px; overflow-y: scroll; font-family: monospace; white-space: pre-wrap; }
        .success { color: green; }
        .error { color: red; font-weight: bold; }
        .info { color: #333; }
    </style>
    
    <script src="https://cdn.jsdelivr.net/pyodide/v0.29.0/full/pyodide.js"></script>
</head>
<body>

    <h2>PySigma Environment (v0.29.0)</h2>
    <div id="status">Initializing...</div>
    <div id="log"></div>

    <script>
        const logElement = document.getElementById("log");
        const statusElement = document.getElementById("status");

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.textContent = message;
            entry.className = type;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        async function main() {
            try {
                // Step 1: Load Pyodide (Latest)
                log("Step 1: Loading Pyodide v0.29.0...", 'info');
                let pyodide = await loadPyodide();
                log("✅ Pyodide loaded.", 'success');

                // Step 2: Load Micropip
                log("Step 2: Loading Micropip...", 'info');
                await pyodide.loadPackage("micropip");
                const micropip = pyodide.pyimport("micropip");
                log("✅ Micropip ready.", 'success');

                // Step 3: Install pySigma
                // Now that we are on Pyodide 0.29.0, we can safely install 'latest' again
                log("Step 3: Installing latest pySigma...", 'info');
                await micropip.install('pysigma');
                log("✅ pySigma (latest) installed successfully.", 'success');

                // Step 4: Install Custom Backend
                // ✅ FIX 2: Ensure your wheel file is renamed to this EXACT format:
                const backendFilename = "custom_backend-0.1.0-py3-none-any.whl";
                
                log(`Step 4: Downloading custom backend: ./${backendFilename}...`, 'info');
                await micropip.install(`./${backendFilename}`);
                log("✅ Custom backend installed successfully.", 'success');

                // Step 5: Verify
                log("Step 5: Verifying imports...", 'info');
                pyodide.runPython(`
import sigma
import custom_backend
import packaging
print(f"Sigma version: {sigma.__version__}")
print(f"Packaging version: {packaging.__version__}")
print("Custom backend imported successfully!")
                `);
                
                statusElement.textContent = "System Ready";
                statusElement.style.color = "green";

            } catch (err) {
                statusElement.textContent = "System Error";
                statusElement.style.color = "red";
                log(`❌ CRITICAL ERROR:\n${err}`, 'error');
            }
        }

        main();
    </script>
</body>
</html>
